# Enumeração SSH

## Introdução

**SSH** (Secure Shell) é protocolo de acesso remoto criptografado.

## Conceitos

### Porta
- 22/TCP: SSH (padrão)
- Outros portas: (configurável)

### Autenticação
- Senha
- Chave privada
- Multifator

---

## Ferramentas

### nmap

```bash
# Detectar SSH
nmap -p 22 target

# Banner grabbing
nmap -p 22 --script ssh-hostkey target

# Enumeração
nmap -p 22 --script ssh-* target
```

### ssh-keyscan

```bash
# Extrair chaves públicas
ssh-keyscan target

# Resultado
target ssh-rsa AAAAB3NzaC1yc2EAAAADAQAB...
target ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNo...
```

### hydra

```bash
# Bruteforce
hydra -l root -P wordlist.txt ssh://target -v

# Com usuário list
hydra -L users.txt -P passwords.txt ssh://target
```

### medusa

```bash
# Alternativa ao hydra
medusa -h target -u root -P wordlist.txt -M ssh
```

---

## Enumeração Passo a Passo

### 1. Detectar SSH

```bash
nmap -p 22 target

# Resultado: 22/tcp open ssh
```

### 2. Banner Grabbing

```bash
nc target 22
ssh -v target

# Resultado
SSH-2.0-OpenSSH_7.4
```

**Informações úteis**:
- Versão OpenSSH
- Protocolo SSH suportado
- Possíveis vulnerabilidades

### 3. Enumerar Usuários

```bash
# Teste de timing attack
ssh-user-enum.py -u wordlist.txt -t target

# Resultado: valid users
root
admin
user
ubuntu
```

### 4. Teste de Chave Privada Padrão

```bash
# Chaves padrão
ssh -i /home/user/.ssh/id_rsa user@target

# Chaves Raspberry Pi
ssh -i insecure_key pi@target
```

---

## Vulnerabilidades Comuns

### Versão Obsoleta

```bash
# OpenSSH < 7.4 com vulnerabilidades
nmap -p 22 --script ssh2-enum-algos target
```

### User Enumeration

```bash
# Diferença de tempo ao testar usuários
# Usuário válido: espera
# Usuário inválido: nega rápido

# Exploit
ssh -v invalid_user@target 2>&1 | grep -i "invalid\|not"
```

### Brute Force

```bash
# Ataque comum em SSH
hydra -l admin -P /usr/share/wordlists/rockyou.txt ssh://target
```

### Chaves SSH Fracas

```bash
# Chaves geradas com parâmetros fracos
ssh-keygen -l -f key.pub
```

---

## Extração de Informações

### Arquivo authorized_keys

```bash
# Se houver acesso
cat ~/.ssh/authorized_keys

# Resultado: Chaves públicas autorizadas
ssh-rsa AAAAB3NzaC1yc2EA... user@host
```

### Arquivo known_hosts

```bash
# Hosts conectados anteriormente
cat ~/.ssh/known_hosts

# Resultado: Histórico de conexões
host1.com ssh-rsa AAAAB...
host2.com ssh-rsa AAAAB...
```

---

## Métodos de Bruteforce

### Hydra (Simples)

```bash
hydra -l admin -P wordlist.txt ssh://target
```

### Hydra (Avançado)

```bash
# Com delay
hydra -l admin -P wordlist.txt ssh://target -t 4 -w 30

# Com usuários múltiplos
hydra -L users.txt -P passwords.txt ssh://target
```

### Medusa

```bash
medusa -h target -u admin -P wordlist.txt -M ssh -n 22 -v
```

---

## SSH Key Cracking

### Se Houver Chave Privada

```bash
# Converter para formato john
ssh2john id_rsa > hash.txt

# Crack
john hash.txt --wordlist=/usr/share/wordlists/rockyou.txt
```

---

## Recolhimento de Informações

### Script Simples

```bash
#!/bin/bash

TARGET=$1

echo "[*] Enumerando SSH em $TARGET"

echo "[+] Banner..."
nc -v -w 2 $TARGET 22

echo "[+] Algoritmos suportados..."
nmap -p 22 --script ssh2-enum-algos $TARGET

echo "[+] Chaves públicas..."
ssh-keyscan $TARGET 2>/dev/null
```

---

## Checklist de Enumeração SSH

```
☐ Porta 22 aberta?
☐ Versão SSH?
☐ Protocolo suportado?
☐ Usuários válidos?
☐ Senhas fracas?
☐ Chaves privadas padrão?
☐ Autenticação multifator?
☐ Historico de conexão (.ssh/known_hosts)?
```

---

Próximo: Exploração com `metasploit.md`
