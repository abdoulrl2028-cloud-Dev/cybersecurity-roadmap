# WHOIS e DIG — Coleta de Informações de Domínio

## WHOIS — Informações de Registro

**WHOIS** fornece informações públicas sobre proprietários de domínios e blocos de IP.

### Instalação

```bash
# Geralmente pré-instalado
whois --version

# Se necessário:
sudo apt install whois
```

### Informações Obtidas

```
- Proprietário do domínio
- Email de contato
- Servers DNS
- Datas de criação/expiração
- Registrador
- Nameservers
```

### Sintaxe

```bash
whois dominio.com
whois example.com
```

### Exemplo Completo

```bash
$ whois google.com

Domain Name: GOOGLE.COM
Registry Domain ID: 2138514_DOMAIN_COM-VRSN
Registrar WHOIS Server: whois.markmonitor.com
Registrar URL: http://www.markmonitor.com
Updated Date: 2024-01-01T00:00:00Z
Creation Date: 1997-09-15T04:00:00Z
Registry Expiry Date: 2025-09-14T04:00:00Z
Registrant Country: US
Admin Name: Domain Administrator
...
```

### Informações Importantes

| Campo | Uso |
|-------|-----|
| Registrant | Proprietário real |
| Admin Contact | Administrador |
| Tech Contact | Contato técnico |
| Name Servers | DNS do domínio |
| Creation/Expiry | Histórico de domínio |

### Técnicas Avançadas

```bash
# Domínios do mesmo proprietário
whois -h whois.arin.net 203.0.113.0

# Informações de IP
whois 8.8.8.8

# Registro mais detalhado
whois -H example.com  # Sem aviso legal
```

---

## DIG — Consultas DNS Detalhadas

**DIG** (Domain Information Groper) é ferramenta poderosa para DNS reconnaissance.

### Instalação

```bash
# Geralmente pré-instalado
sudo apt install dnsutils
```

### Conceitos

- **A**: IPv4
- **AAAA**: IPv6
- **MX**: Mail servers
- **NS**: Nameservers
- **TXT**: Text records
- **CNAME**: Canonical name
- **SOA**: Start of Authority

### Sintaxe Básica

```bash
dig dominio.com              # Query A record (padrão)
dig dominio.com A            # Explícito
dig dominio.com AAAA         # IPv6
dig dominio.com MX           # Servidores de email
dig dominio.com NS           # Nameservers
dig dominio.com TXT          # Registros de texto
```

### Exemplo Prático

```bash
$ dig google.com

; <<>> DiG 9.x <<>> google.com
;; global options: +cmd
;; Got answer:
;; ->>HEADER<<- opcode: QUERY, status: NOERROR

google.com.     299 IN  A   142.250.185.46
google.com.     299 IN  A   142.250.185.14

;; Query time: 25 msec
;; SERVER: 8.8.8.8#53(8.8.8.8)
;; WHEN: Mon Dec 05 00:00:00 UTC 2024
;; MSG SIZE  rcvd: 55
```

### Opções Úteis

```bash
dig +short dominio.com              # Resposta curta
dig @8.8.8.8 dominio.com            # DNS específico
dig +trace dominio.com              # Trace completo
dig +dnssec dominio.com             # Validação DNSSEC
dig +nocmd dominio.com +noall +answer  # Apenas resposta
dig -x 142.250.185.46               # Reverse DNS lookup
```

### Reverse DNS Lookup

```bash
# Descobrir domínio a partir de IP
dig -x 8.8.8.8

# Resultado
8.8.8.8.in-addr.arpa. 12345 IN PTR dns.google.
```

### Zone Transfer (Advanced)

Tentar transferir zona completa (geralmente bloqueado):

```bash
dig @ns1.dominio.com dominio.com axfr
```

---

## Reconhecimento com DIG

### Descobrir Subdomínios

```bash
# Bruteforce de subdomínios
for sub in www mail ftp admin test dev; do
  dig $sub.dominio.com +short
done

# Com arquivo de lista
while read sub; do
  echo "Testando: $sub.dominio.com"
  dig $sub.dominio.com +short
done < subdomains.txt
```

### Coletar Informações

```bash
# Todos os records (ANY)
dig dominio.com ANY

# SOA (informações do servidor)
dig dominio.com SOA

# Nameservers
dig dominio.com NS

# Mail servers
dig dominio.com MX
```

### Exemplo Completo

```bash
$ dig google.com MX

google.com.  3599 IN  MX  10 smtp.google.com.
google.com.  3599 IN  MX  20 alt1.aspmx.l.google.com.
google.com.  3599 IN  MX  30 alt2.aspmx.l.google.com.

# Resultado: Usuários podem enviar para esses servidores
```

---

## NSLOOKUP — Alternativa Simples

Ferramenta mais simples que DIG, multiplataforma:

```bash
nslookup dominio.com         # Query básica
nslookup -type=MX dominio.com
nslookup -type=NS dominio.com
nslookup 203.0.113.1         # Reverse lookup
```

### Diferenças

| Aspecto | DIG | NSLOOKUP |
|--------|-----|----------|
| Power | Mais poderoso | Simples |
| Verboso | Muito | Moderado |
| Scripts | Melhor | OK |
| Multiplataforma | Linux/Mac | Windows/Unix |

---

## HOST — Ferramenta Simples

```bash
host dominio.com
host -a dominio.com          # Todos os records
host -t MX dominio.com       # Type específico
host 203.0.113.1             # Reverse
```

---

## Técnicas de Enumeração

### 1. Reconhecimento Passivo

```bash
# Informações públicas
whois dominio.com
whois 203.0.113.0

# DNS records
dig dominio.com ANY
dig dominio.com NS
dig dominio.com MX
```

### 2. Buscar Subdomínios

```bash
# Manualmente com DIG
dig subdomain.dominio.com +short

# Script simples
#!/bin/bash
for sub in $(cat subdomains.txt); do
  dig $sub.dominio.com +short | grep -v "^$"
done
```

### 3. DNS Brute Force

```bash
# Ferramenta: dnsrecon
dnsrecon -d dominio.com -t brt

# Ou com script
host -l dominio.com
```

---

## Ferramenta Unificada: dnsrecon

```bash
sudo apt install dnsrecon

# Scan completo
dnsrecon -d dominio.com -t std

# Bruteforce
dnsrecon -d dominio.com -t brt -D /usr/share/dnsrecon/namelist.txt

# Zone transfer
dnsrecon -d dominio.com -t axfr
```

---

## Saída e Reportagem

### Salvar Resultados

```bash
# DIG
dig dominio.com > dns_info.txt

# WHOIS
whois dominio.com > whois_info.txt

# dnsrecon
dnsrecon -d dominio.com -t std -x > dns_report.xml
```

### Formato JSON

```bash
# dnsrecon em JSON
dnsrecon -d dominio.com -t std -j output.json
```

---

## Checklist de Reconhecimento

```
☐ WHOIS do domínio
☐ WHOIS dos IPs
☐ A records
☐ AAAA records (IPv6)
☐ MX records
☐ NS records
☐ TXT records
☐ CNAME records
☐ SOA records
☐ Reverse DNS
☐ Bruteforce de subdomínios
☐ Verificar histórico (archive.org)
```

---

Próximo: `footprinting.md` para técnicas avançadas.
